<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng kí lịch dạy</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<div class="container mt-5">
    <div th:include="subTemplates/header-home.html"> </div>
    <br>
    <br>
    <h2>Đăng kí môn học</h2>

    <!-- Dropdown list of courses -->
    <!--    <div class="form-group">-->
    <!--        <label for="coursesDropdown">Chọn môn học:</label>-->
    <!--        <select class="form-control" id="coursesDropdown">-->
    <!--            <option value="">Chọn một môn học</option>-->
    <!--            &lt;!&ndash; Sử dụng Thymeleaf để lặp qua danh sách các môn học và hiển thị chúng &ndash;&gt;-->
    <!--            <th:block th:each="subject : ${listSubject}">-->
    <!--                <option th:value="${subject.id}" th:text="${subject.name}"></option>-->
    <!--            </th:block>-->
    <!--        </select>-->
    <!--    </div>-->

    <div class="form-group">
        <label for="coursesDropdown">Chọn môn học:</label>
        <select class="form-control" id="coursesDropdown" onchange="redirectToSelectedSubject()">
            <option value="">Chọn một môn học</option>
            <!-- Sử dụng Thymeleaf để lặp qua danh sách các môn học và hiển thị chúng -->
            <th:block th:each="subject : ${listSubject}">
                <option th:value="${subject.id}" th:text="${subject.name}"></option>
            </th:block>
        </select>
    </div>

    <script>
        // Hàm này được gọi khi trang được load lại
        window.onload = function() {
            // Lấy id của môn học từ đường dẫn URL
            var selectedSubjectId = window.location.pathname.split('/').pop();

            // Kiểm tra xem selectedSubjectId có giá trị không rỗng
            if (selectedSubjectId) {
                // Đặt giá trị của dropdown thành id của môn học được chọn trước đó
                document.getElementById("coursesDropdown").value = selectedSubjectId;
            }
        };

        function redirectToSelectedSubject() {
            // Lấy giá trị id của môn học được chọn
            var selectedSubjectId = document.getElementById("coursesDropdown").value;

            // Kiểm tra xem giá trị đã được chọn chưa
            if (selectedSubjectId) {
                // Chuyển hướng đến URL mong muốn với id của môn học được chọn được thêm vào
                window.location.href = "/subject/" + selectedSubjectId;
            }
        }
    </script>


    <h3>Các lớp học phần có thể đăng kí</h3>

    <table class="table" id="availableClassesTable">
        <!-- Tiêu đề bảng -->
        <thead>
        <tr>
            <th>Tên lớp học phần</th>
            <th>Thời gian</th>
            <th>Chọn</th>
        </tr>
        </thead>
        <!-- Dữ liệu lịch học -->
        <tbody id="availableClassesBody">
        <tr th:each="schedule : ${listSchedule}">
            <td th:text="${schedule.getSectionClass().getName()}"></td>
            <td th:text="${schedule.getPeriod().getName()} + ' ' +  ${schedule.getDay().getName()} +' '+ ${schedule.getPeriod().getDescription()}"></td>
            <td>
                <!-- Checkbox -->
                <input type="checkbox" class="classCheckbox" th:data-id="${schedule.id}">
            </td>
        </tr>
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            // Xử lý sự kiện khi checkbox được chọn
            $('.classCheckbox').change(function() {
                // Kiểm tra xem checkbox đã được chọn hay không
                if ($(this).is(':checked')) {
                    // Lấy giá trị id của lịch học được chọn từ thuộc tính data
                    var selectedClassId = $(this).data('id');

                    // Tạo URL mới với ID của lớp học phần
                    var newURL = "/section-class/" + selectedClassId;

                    // Chuyển hướng đến đường dẫn mới
                    window.location.href = newURL;
                }
            });
        });
    </script>


    <!-- Registered classes -->
    <h3>Các lớp học phần đã đăng kí</h3>
    <table class="table">
        <thead>
        <tr>
            <th>Tên lớp học phần</th>
            <th>Thời gian</th>
        </tr>
        </thead>
        <tbody id="registeredClasses">
        <!-- This section will be populated with registered classes using JavaScript -->
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function() {
        // Sample data of available classes for each course
        var classesData = {
            course1: [
                { name: "Lớp học phần 1 - Môn 1", time: "Thứ 2, 8:00 - 10:00" },
                { name: "Lớp học phần 2 - Môn 1", time: "Thứ 3, 10:00 - 12:00" },
            ],
            course2: [
                { name: "Lớp học phần 1 - Môn 2", time: "Thứ 4, 8:00 - 10:00" },
                { name: "Lớp học phần 2 - Môn 2", time: "Thứ 5, 10:00 - 12:00" },
            ],
            course3: [
                { name: "Lớp học phần 1 - Môn 3", time: "Thứ 6, 8:00 - 10:00" },
                { name: "Lớp học phần 2 - Môn 3", time: "Thứ 7, 10:00 - 12:00" },
            ]
            // Add more data as needed
        };

        // Function to populate available classes for the selected course
        function populateAvailableClasses(course) {
            var classes = classesData[course];
            var tableBody = $('#availableClassesBody');
            tableBody.empty();
            if (classes) {
                $('#availableClassesTable').show();
                $.each(classes, function(index, classInfo) {
                    tableBody.append('<tr><td>' + classInfo.name + '</td><td>' + classInfo.time + '</td><td><input type="checkbox" name="' + classInfo.name + '"></td></tr>');
                });
            } else {
                $('#availableClassesTable').hide();
            }
        }

        // Event listener for dropdown change
        $('#coursesDropdown').change(function() {
            var selectedCourse = $(this).val();
            populateAvailableClasses(selectedCourse);
        });

        // Event listener for checkbox changes to register classes
        $(document).on('change', 'input[type="checkbox"]', function() {
            var className = $(this).closest('tr').find('td:first').text();
            var time = $(this).closest('tr').find('td:eq(1)').text();
            if (this.checked) {
                $('#registeredClasses').append('<tr><td>' + className + '</td><td>' + time + '</td></tr>');
            } else {
                $('#registeredClasses').find('td:contains(' + className + ')').closest('tr').remove();
            }
        });
    });
</script>

</body>
</html>
