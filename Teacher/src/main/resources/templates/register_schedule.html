<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng kí lịch dạy</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <div th:include="subTemplates/header-home.html"> </div>
    <br>
    <br>
    <h2>Đăng kí lịch dạy</h2>

    <!-- Dropdown list of courses -->
<!--    <div class="form-group">-->
<!--        <label for="coursesDropdown">Chọn môn học:</label>-->
<!--        <select class="form-control" id="coursesDropdown">-->
<!--            <option value="">Chọn một môn học</option>-->
<!--            &lt;!&ndash; Sử dụng Thymeleaf để lặp qua danh sách các môn học và hiển thị chúng &ndash;&gt;-->
<!--            <th:block th:each="subject : ${listSubject}">-->
<!--                <option th:value="${subject.id}" th:text="${subject.name}"></option>-->
<!--            </th:block>-->
<!--        </select>-->
<!--    </div>-->

    <div class="form-group">
        <label for="coursesDropdown">Chọn môn học:</label>
        <select class="form-control" id="coursesDropdown" onchange="redirectToSelectedSubject()">
            <option value="">Chọn một môn học</option>
            <!-- Sử dụng Thymeleaf để lặp qua danh sách các môn học và hiển thị chúng -->
            <th:block th:each="subject : ${listSubject}">
                <option th:value="${subject.id}" th:text="${subject.name}"></option>
            </th:block>
        </select>
    </div>

    <script>
        // Hàm này được gọi khi trang được load lại
        window.onload = function() {
            // Lấy id của môn học từ đường dẫn URL
            var selectedSubjectId = window.location.pathname.split('/').pop();

            // Kiểm tra xem selectedSubjectId có giá trị không rỗng
            if (selectedSubjectId) {
                // Đặt giá trị của dropdown thành id của môn học được chọn trước đó
                document.getElementById("coursesDropdown").value = selectedSubjectId;
            }
        };

        function redirectToSelectedSubject() {
            // Lấy giá trị id của môn học được chọn
            var selectedSubjectId = document.getElementById("coursesDropdown").value;

            // Kiểm tra xem giá trị đã được chọn chưa
            if (selectedSubjectId) {
                // Chuyển hướng đến URL mong muốn với id của môn học được chọn được thêm vào
                window.location.href = "/subject/" + selectedSubjectId;
            }
        }
    </script>


    <table class="table" id="availableClassesTable">
        <!-- Tiêu đề bảng -->
        <thead>
        <tr>
            <th>Tên lớp học phần</th>
            <th>Thời gian</th>
            <th>Chọn</th>
        </tr>
        </thead>
        <!-- Dữ liệu lịch học -->
        <tbody id="availableClassesBody">
        <tr th:each="schedule : ${listSchedule}">
            <td th:text="${schedule.getSectionClass().getName()}"></td>
            <td th:text="${schedule.getPeriod().getName()} + ' ' +  ${schedule.getDay().getName()} +' '+ ${schedule.getPeriod().getDescription()}"></td>
            <td>
                <!-- Checkbox -->
                <input type="checkbox" class="classCheckbox" data-id="${schedule.id}">
            </td>
        </tr>
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            // Xử lý sự kiện khi checkbox được chọn
            $('.classCheckbox').change(function() {
                // Kiểm tra xem checkbox đã được chọn hay không
                if ($(this).is(':checked')) {
                    // Lấy giá trị id của lịch học được chọn từ thuộc tính data
                    var selectedClassId = $(this).data('id');

                    // Tạo URL mới với ID của lớp học phần
                    var newURL = "/section-class/" + selectedClassId;

                    // Chuyển hướng đến đường dẫn mới
                    window.location.href = newURL;
                }
            });
        });
    </script>


    <h3>Các lớp học phần đã đăng kí</h3>
    <table class="table">
        <thead>
        <tr>
            <th>Nhóm</th>
            <th>Tên lớp học phần</th>
            <th>Thời gian</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody id="registeredClasses">
        <!-- Thymeleaf iteration to populate table rows -->
        <tr th:each="picked : ${listPicked}">
            <td th:text="${picked.sectionClass.getName()}"></td>
            <td th:text="${picked.getSectionClass().getSubjectOfSemester().getSubject().getName()}"></td>
            <td th:text="${picked.pickedTime}"></td>
            <td>
                <button th:id="'delete-btn-' + ${picked.id}"
                        class="delete-btn btn btn-danger"
                        th:attr="data-id=${picked.id}">Xóa</button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Hộp thoại confirm -->
    <div id="confirm-dialog" class="confirm-dialog">
        <div class="confirm-content">
            <p>Bạn có chắc muốn xóa lớp học phần này không?</p>
            <button id="confirm-ok-btn" class="confirm-btn">OK</button>
            <button id="confirm-cancel-btn" class="confirm-btn">Cancel</button>
        </div>
    </div>

    <style>

        /* CSS cho hộp thoại confirm */
        .confirm-dialog {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .confirm-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;
            text-align: center;
        }

        .confirm-btn {
            margin: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }

        .confirm-btn:hover {
            background-color: #ddd;
        }

    </style>

    <script>

        // Bắt sự kiện click trên nút button xóa
        // Bắt sự kiện click trên nút button xóa
        document.addEventListener('DOMContentLoaded', function () {
            var deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(function (button) {
                button.addEventListener('click', function (event) {
                    var id = event.target.dataset.id; // Lấy id của lớp học phần từ thuộc tính data-id của nút xóa
                    // Hiển thị hộp confirm
                    document.getElementById('confirm-dialog').style.display = 'block';
                    // Bắt sự kiện click trên nút OK
                    document.getElementById('confirm-ok-btn').addEventListener('click', function () {
                        // Thực hiện hành động xóa ở đây
                        window.location.href = '/delete/' + id; // Chuyển đến đường dẫn xóa
                    });
                    // Bắt sự kiện click trên nút Cancel
                    document.getElementById('confirm-cancel-btn').addEventListener('click', function () {
                        // Ẩn hộp confirm nếu người dùng chọn Cancel
                        document.getElementById('confirm-dialog').style.display = 'none';
                    });
                });
            });
        });
    </script>



</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function() {
        // Sample data of available classes for each course
        var classesData = {
            course1: [
                { name: "Lớp học phần 1 - Môn 1", time: "Thứ 2, 8:00 - 10:00" },
                { name: "Lớp học phần 2 - Môn 1", time: "Thứ 3, 10:00 - 12:00" },
            ],
            course2: [
                { name: "Lớp học phần 1 - Môn 2", time: "Thứ 4, 8:00 - 10:00" },
                { name: "Lớp học phần 2 - Môn 2", time: "Thứ 5, 10:00 - 12:00" },
            ],
            course3: [
                { name: "Lớp học phần 1 - Môn 3", time: "Thứ 6, 8:00 - 10:00" },
                { name: "Lớp học phần 2 - Môn 3", time: "Thứ 7, 10:00 - 12:00" },
            ]
            // Add more data as needed
        };

        // Function to populate available classes for the selected course
        function populateAvailableClasses(course) {
            var classes = classesData[course];
            var tableBody = $('#availableClassesBody');
            tableBody.empty();
            if (classes) {
                $('#availableClassesTable').show();
                $.each(classes, function(index, classInfo) {
                    tableBody.append('<tr><td>' + classInfo.name + '</td><td>' + classInfo.time + '</td><td><input type="checkbox" name="' + classInfo.name + '"></td></tr>');
                });
            } else {
                $('#availableClassesTable').hide();
            }
        }

        // Event listener for dropdown change
        $('#coursesDropdown').change(function() {
            var selectedCourse = $(this).val();
            populateAvailableClasses(selectedCourse);
        });

        // Event listener for checkbox changes to register classes
        $(document).on('change', 'input[type="checkbox"]', function() {
            var className = $(this).closest('tr').find('td:first').text();
            var time = $(this).closest('tr').find('td:eq(1)').text();
            if (this.checked) {
                $('#registeredClasses').append('<tr><td>' + className + '</td><td>' + time + '</td></tr>');
            } else {
                $('#registeredClasses').find('td:contains(' + className + ')').closest('tr').remove();
            }
        });
    });
</script>

</body>
</html>
